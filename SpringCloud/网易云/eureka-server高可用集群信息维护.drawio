<mxfile host="app.diagrams.net" modified="2021-01-28T23:06:32.876Z" agent="5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3861.400 QQBrowser/10.7.4313.400" etag="k0idrCsR3bEOYbrBrHRg" version="14.2.7" type="github">
  <diagram id="cwYzjmjVExxF-Va3FA4w" name="Page-1">
    <mxGraphModel dx="1067" dy="486" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="7cnjzRK2snPHN8T6IAAg-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.489;entryY=-0.011;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="7cnjzRK2snPHN8T6IAAg-2" target="7cnjzRK2snPHN8T6IAAg-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-2" value="&lt;span&gt;spring-cloud-netfix-eureka-client&lt;/span&gt;&lt;br&gt;&lt;span&gt;spring.factories&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="160" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.529;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="7cnjzRK2snPHN8T6IAAg-3" target="7cnjzRK2snPHN8T6IAAg-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-3" value="eureka集群,消息互通" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="354" y="30" width="266" height="60" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="7cnjzRK2snPHN8T6IAAg-5" target="7cnjzRK2snPHN8T6IAAg-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-5" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;EurekaServerAutoConfiguration&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;&lt;pre style=&quot;font-size: 12pt&quot;&gt;&lt;span style=&quot;color: #808000&quot;&gt;@Bean&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;public &lt;/span&gt;EurekaServerContext eurekaServerContext(ServerCodecs serverCodecs,&lt;br&gt;      PeerAwareInstanceRegistry registry, PeerEurekaNodes peerEurekaNodes) {&lt;br&gt;   &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;return new &lt;/span&gt;DefaultEurekaServerContext(&lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;this&lt;/span&gt;.&lt;span style=&quot;color: #660e7a ; font-weight: bold&quot;&gt;eurekaServerConfig&lt;/span&gt;, serverCodecs,&lt;br&gt;         registry, peerEurekaNodes, &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;this&lt;/span&gt;.&lt;span style=&quot;color: #660e7a ; font-weight: bold&quot;&gt;applicationInfoManager&lt;/span&gt;);&lt;br&gt;}&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="162" y="310" width="650" height="180" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="7cnjzRK2snPHN8T6IAAg-7" target="7cnjzRK2snPHN8T6IAAg-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-7" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;DefaultEurekaServerContext&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;&lt;pre style=&quot;font-size: 12pt&quot;&gt;&lt;span style=&quot;color: #808000&quot;&gt;@PostConstruct&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #808000&quot;&gt;@Override&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;public void &lt;/span&gt;initialize() {&lt;br&gt;    &lt;span style=&quot;color: #660e7a ; font-weight: bold ; font-style: italic&quot;&gt;logger&lt;/span&gt;.info(&lt;span style=&quot;color: #008000 ; font-weight: bold&quot;&gt;&quot;Initializing ...&quot;&lt;/span&gt;);&lt;br&gt;    &lt;span style=&quot;color: #660e7a ; font-weight: bold&quot;&gt;peerEurekaNodes&lt;/span&gt;.start();&lt;br&gt;    &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;try &lt;/span&gt;{&lt;br&gt;        &lt;span style=&quot;color: #660e7a ; font-weight: bold&quot;&gt;registry&lt;/span&gt;.init(&lt;span style=&quot;color: #660e7a ; font-weight: bold&quot;&gt;peerEurekaNodes&lt;/span&gt;);&lt;br&gt;    } &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;catch &lt;/span&gt;(Exception e) {&lt;br&gt;        &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;throw new &lt;/span&gt;RuntimeException(e);&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;color: #660e7a ; font-weight: bold ; font-style: italic&quot;&gt;logger&lt;/span&gt;.info(&lt;span style=&quot;color: #008000 ; font-weight: bold&quot;&gt;&quot;Initialized&quot;&lt;/span&gt;);&lt;br&gt;}&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="242" y="570" width="490" height="290" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="7cnjzRK2snPHN8T6IAAg-9" target="7cnjzRK2snPHN8T6IAAg-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-9" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;start(){&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;...&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;&lt;pre style=&quot;font-size: 12pt&quot;&gt;updatePeerEurekaNodes(resolvePeerUrls());&lt;br&gt;Runnable peersUpdateTask = &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;new &lt;/span&gt;Runnable() {&lt;br&gt;    &lt;span style=&quot;color: #808000&quot;&gt;@Override&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #808000&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;public void &lt;/span&gt;run() {&lt;br&gt;        &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;try &lt;/span&gt;{&lt;br&gt;            updatePeerEurekaNodes(resolvePeerUrls());&lt;br&gt;        } &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;catch &lt;/span&gt;(Throwable e) {&lt;br&gt;            &lt;span style=&quot;color: #660e7a ; font-weight: bold ; font-style: italic&quot;&gt;logger&lt;/span&gt;.error(&lt;span style=&quot;color: #008000 ; font-weight: bold&quot;&gt;&quot;Cannot update the replica Nodes&quot;&lt;/span&gt;, e);&lt;br&gt;        }&lt;br&gt;&lt;br&gt;    }&lt;br&gt;};&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;...&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;}&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="197" y="970" width="580" height="380" as="geometry" />
        </mxCell>
        <mxCell id="7cnjzRK2snPHN8T6IAAg-11" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;resolvePeerUrls(){&lt;br&gt;//获取配置的zone节点,eureka集群节点,&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;并将自己过滤&lt;/pre&gt;&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-size: 12pt&quot;&gt;}&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="337" y="1430" width="300" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
